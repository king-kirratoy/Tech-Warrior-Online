<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Tech Warrior: Garage & Loadout</title>
    <script src="https://cdn.jsdelivr.net/npm/phaser@3.60.0/dist/phaser.min.js"></script>
    <style>
        body { margin: 0; background: #000; color: #0f0; font-family: 'Courier New', Courier, monospace; overflow: hidden; }
        #ui-layer { position: absolute; top: 10px; left: 10px; pointer-events: none; }
        .stat-readout { background: rgba(0,20,0,0.8); padding: 10px; border: 1px solid #0f0; margin-bottom: 5px; pointer-events: auto; }
        button { background: #050; color: #0f0; border: 1px solid #0f0; cursor: pointer; margin: 2px; padding: 5px; }
        button:hover { background: #0f0; color: #000; }
    </style>
</head>
<body>

<div id="ui-layer">
    <div class="stat-readout" id="garage-menu">
        <h2>--- GARAGE ---</h2>
        <div>CHASSIS: 
            <button onclick="setChassis('light')">Light (75T)</button>
            <button onclick="setChassis('medium')">Medium (125T)</button>
            <button onclick="setChassis('heavy')">Heavy (200T)</button>
        </div>
        <div>LEFT ARM: 
            <button onclick="setWeapon('L', 'mg')">MG</button>
            <button onclick="setWeapon('L', 'heavy')">Heavy</button>
            <button onclick="setWeapon('L', 'shield')">Shield</button>
            <button onclick="setWeapon('L', 'sword')">Sword</button>
        </div>
        <div>RIGHT ARM: 
            <button onclick="setWeapon('R', 'mg')">MG</button>
            <button onclick="setWeapon('R', 'heavy')">Heavy</button>
            <button onclick="setWeapon('R', 'shield')">Shield</button>
            <button onclick="setWeapon('R', 'sword')">Sword</button>
        </div>
        <div>LEGS: 
            <button onclick="setMod('speed')">Speed Mod</button>
            <button onclick="setMod('jump')">Jump Jets</button>
        </div>
        <div>COLOR: 
            <button onclick="setColor(0x00ff00)">Green</button>
            <button onclick="setColor(0xff0000)">Red</button>
            <button onclick="setColor(0x0000ff)">Blue</button>
        </div>
        <hr>
        <div id="weight-meter">WEIGHT: 0 / 0</div>
        <button id="deploy-btn" style="width:100%; font-weight:bold;" onclick="deploy()">DEPLOY UNIT</button>
    </div>
</div>

<script>
// --- DATA TABLES ---
const WEAPONS = {
    mg:     { name: 'Machine Gun', weight: 15, dmg: 5, color: 0xaaaaaa, type: 'range' },
    heavy:  { name: 'Heavy Gun',   weight: 45, dmg: 20, color: 0x555555, type: 'range' },
    shield: { name: 'Shield',      weight: 30, hp: 100, color: 0x00ffff, type: 'def' },
    sword:  { name: 'Sword',       weight: 20, dmg: 30, color: 0xffffff, type: 'melee' }
};

const CHASSIS = {
    light:  { name: 'Light',  maxW: 75,  speed: 300, color: 0x333333 },
    medium: { name: 'Medium', maxW: 125, speed: 200, color: 0x444444 },
    heavy:  { name: 'Heavy',  maxW: 200, speed: 120, color: 0x222222 }
};

const MODS = {
    speed: { name: 'Speed Mod', weight: 10, speedBoost: 50 },
    jump:  { name: 'Jump Jets', weight: 20, jump: true }
};

// --- GLOBAL LOADOUT ---
let currentLoadout = {
    chassis: 'medium',
    leftArm: 'mg',
    rightArm: 'mg',
    mod: 'speed',
    color: 0x00ff00,
    totalWeight: 0
};

// --- GAME LOGIC ---
const config = {
    type: Phaser.AUTO,
    width: window.innerWidth,
    height: window.innerHeight,
    physics: { default: 'arcade' },
    scene: { create: create, update: update }
};

const game = new Phaser.Game(config);
let player, keys, isDeployed = false;

function create() {
    keys = this.input.keyboard.addKeys('W,A,S,D,SPACE');
    this.updateUI = () => {
        let w = CHASSIS[currentLoadout.chassis].maxW;
        let cur = WEAPONS[currentLoadout.leftArm].weight + WEAPONS[currentLoadout.rightArm].weight + CHASSIS[currentLoadout.chassis].weight + (currentLoadout.mod ? MODS[currentLoadout.mod].weight : 0);
        currentLoadout.totalWeight = cur;
        document.getElementById('weight-meter').innerText = `WEIGHT: ${cur} / ${w} TONS`;
        document.getElementById('deploy-btn').disabled = cur > w;
    };
    this.updateUI();
}

function deploy() {
    document.getElementById('garage-menu').style.display = 'none';
    isDeployed = true;
    
    let scene = game.scene.scenes[0];
    player = scene.add.container(400, 300);
    
    // Draw Chassis
    let base = scene.add.rectangle(0, 0, 50, 50, currentLoadout.color).setStrokeStyle(2, 0xffffff);
    
    // Draw Arms
    let lArm = scene.add.rectangle(-35, 0, 20, 40, WEAPONS[currentLoadout.leftArm].color);
    let rArm = scene.add.rectangle(35, 0, 20, 40, WEAPONS[currentLoadout.rightArm].color);
    
    player.add([base, lArm, rArm]);
    scene.physics.add.existing(player);
    player.body.setCollideWorldBounds(true).setDrag(400);
}

function update() {
    if (!isDeployed) return;

    let moveSpeed = CHASSIS[currentLoadout.chassis].speed;
    if(currentLoadout.mod === 'speed') moveSpeed += MODS.speed.speedBoost;
    moveSpeed -= (currentLoadout.totalWeight * 0.5);

    if (keys.A.isDown) player.body.setAngularVelocity(-150);
    else if (keys.D.isDown) player.body.setAngularVelocity(150);
    else player.body.setAngularVelocity(0);

    if (keys.W.isDown) {
        this.physics.velocityFromRotation(player.rotation, moveSpeed, player.body.velocity);
    }
}

// --- UI SETTERS ---
function setChassis(type) { currentLoadout.chassis = type; game.scene.scenes[0].updateUI(); }
function setWeapon(side, type) { 
    if(side === 'L') currentLoadout.leftArm = type; 
    else currentLoadout.rightArm = type;
    game.scene.scenes[0].updateUI(); 
}
function setMod(type) { currentLoadout.mod = type; game.scene.scenes[0].updateUI(); }
function setColor(color) { currentLoadout.color = color; }
</script>
</body>
</html>
